unit app1;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, mmSystem, Vcl.StdCtrls, System.Diagnostics;

type
  TFrMain = class(TForm)
    Sh1: TShape;
    Bt2: TButton;
    Timer1: TTimer;
    Target1: TShape;
    Target2: TShape;
    procedure Bt2Click(Sender: TObject);
    procedure Timer1Timer(Sender: TObject);
    procedure FormCreate(Sender: TObject);
  private
    StartTime: TDateTime;
    TargetsHit: Integer;
    procedure CheckCollision;
    procedure ResetGame;
  public
  end;

var
  FrMain: TFrMain;

implementation

{$R *.dfm}

procedure TFrMain.FormCreate(Sender: TObject);
begin
  Timer1.Enabled := False;
  Timer1.Interval := 50;
  Randomize;
end;

procedure TFrMain.ResetGame;
begin
  TargetsHit := 0;
  StartTime := Now;

  Target1.Brush.Color := clBlue;
  Target1.Left := Random(Self.ClientWidth - Target1.Width);
  Target1.Top := Random(Self.ClientHeight - Target1.Height);
  Target1.Visible := True;

  Target2.Brush.Color := clBlue;
  Target2.Left := Random(Self.ClientWidth - Target2.Width);
  Target2.Top := Random(Self.ClientHeight - Target2.Height);
  Target2.Visible := True;

  Timer1.Enabled := True;
end;

procedure TFrMain.Bt2Click(Sender: TObject);
begin
  ResetGame;
end;

procedure TFrMain.Timer1Timer(Sender: TObject);
var
  myjoy: Tjoyinfo;
  b1, b2, b3, b4: Boolean;
begin

  if joyGetPos(JOYSTICKID1, @myjoy) = JOYERR_NOERROR then
  begin
    b1 := (myjoy.wbuttons and JOY_BUTTON1) > 0; // ขึ้น
    b2 := (myjoy.wbuttons and JOY_BUTTON2) > 0; // ขวา
    b3 := (myjoy.wbuttons and JOY_BUTTON3) > 0; // ลง
    b4 := (myjoy.wbuttons and JOY_BUTTON4) > 0; // ซ้าย

    if b1 then Sh1.Top := Sh1.Top - 10;
    if b3 then Sh1.Top := Sh1.Top + 10;
    if b2 then Sh1.Left := Sh1.Left + 10;
    if b4 then Sh1.Left := Sh1.Left - 10;

    // 2. ตรวจสอบการชน
    CheckCollision;
  end;
end;

procedure TFrMain.CheckCollision;
  // Function ช่วยเช็คว่า Sh1 ชนกับเป้าหมายหรือไม่
  function IsHitting(Obj: TShape): Boolean;
  begin
    Result := (Sh1.Left < Obj.Left + Obj.Width) and
              (Sh1.Left + Sh1.Width > Obj.Left) and
              (Sh1.Top < Obj.Top + Obj.Height) and
              (Sh1.Top + Sh1.Height > Obj.Top);
  end;

begin
  // เช็คเป้าหมายที่ 1 (ถ้ายังไม่เคยชน)
  if (Target1.Brush.Color <> clGreen) and IsHitting(Target1) then
  begin
    Target1.Brush.Color := clGreen; // เปลี่ยนสีเมื่อชน
    Inc(TargetsHit);
  end;

  // เช็คเป้าหมายที่ 2 (ถ้ายังไม่เคยชน)
  if (Target2.Brush.Color <> clGreen) and IsHitting(Target2) then
  begin
    Target2.Brush.Color := clGreen; // เปลี่ยนสีเมื่อชน
    Inc(TargetsHit);
  end;

  // 3. ถ้าชนครบ 2 กล่อง
  if TargetsHit = 2 then
  begin
    Timer1.Enabled := False;
    ShowMessage('คุณชนะแล้ว! ' + sLineBreak +
                'เวลาที่ใช้: ' + FormatDateTime('nn:ss', Now - StartTime) + ' นาที');
  end;
end;

end.
